<link rel="import" href="../../../lib/polymer/polymer.html">
<link rel="import" href="../../../lib/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../../lib/neon-animation/neon-animated-pages.html">
<link rel="import" href="../../../lib/neon-animation/neon-animatable.html">
<link rel="import" href="../../../lib/neon-animation/neon-animations.html">
<link rel="import" href="../../../lib/iron-ajax/iron-ajax.html">
<link rel="import" href="../../../lib/iron-list/iron-list.html">
<link rel="import" href="../../../lib/paper-fab/paper-fab.html">

<link rel="import" href="../../../AWSLib/awsl-listeditor-behavior">
<link rel="import" href="../awsl-editor/awsl-editor.html">

<dom-module id="awsl-listeditor">
    <template>
        <style>
            :host {
                @apply(--layout-vertical);
            }

            iron-list {
                height: calc(100vh - 96px);
                background-color: var(--paper-grey-200, #eee);
                padding-bottom: 16px;
                @apply(--layout-flex);
                @apply(--layout-scroll);
                margin: 8px;
            }

            .item {
                cursor: pointer;
                padding: 16px 22px;
                border-bottom: 1px solid #DDD;
            }

            .item:hover {
                outline: 0;
                background-color: var(--google-grey-300);
                border-bottom: 1px solid #ccc;
            }

            #listContent {
                height:calc(100vh - 64px);
                height:-moz-calc(100vh - 64px);
                height:-webkit-calc(100vh - 64px);
                overflow-x: hidden;
                overflow-y: auto;
            }

            paper-fab {
                position: fixed;
                right: 50px;
                bottom: 50px;
            }
        </style>

        <neon-animated-pages id="pages" class="flex" selected="0" entry-animation="slide-from-right-animation" exit-animation="slide-left-animation">
            <neon-animatable>
                <div id="listContent" style="min-height: 100px;">
                    <paper-fab icon="add" on-tap="_onAdd"></paper-fab>
                    <iron-list id="itemsList" as="item" items="[[items]]" scroll-target="listContent">
                    </iron-list>
                </div>
            </neon-animatable>
            <neon-animatable>
                <div>
                    <awsl-editor id="editor" on-saved="_onSaved" on-close="_onClose" oname="{{oname}}"
                                 edithref="[[edithref]]" editelement="[[editelement]]">
                    </awsl-editor>
                </div>
            </neon-animatable>
        </neon-animated-pages>
    </template>
    <script>
        Polymer({
            is: 'awsl-listeditor',
            behaviors: [AWSLBehaviors.ListEditorBehavior],
            getListTemplate: function() {
                var ironlisttemplate = document.createElement('template');

                ironlisttemplate.id = "tempList";

                ironlisttemplate.innerHTML = "<div class='item style-scope awsl-listeditor' on-click='_selectedItemChanged'>"
                    + "<" + this.listelement + " item='[[item]]' />"
                    + "</div>";

                return ironlisttemplate;
            },
            reset: function () {
                if (this.$.pages.selected != 0) {
                    this.$.pages.entryAnimation = "slide-from-left-animation";
                    this.$.pages.exitAnimation = "slide-right-animation";
                    this.$.pages.selected = 0;
                }
            },
            _computedClass: function (isSelected) {
                var classes = 'item';
                if (isSelected) {
                    classes += ' selected';
                }
                return classes;
            },
            _selectedItemChanged: function (e) {
                this.key = e.model.item.key;
                this.$.editor.load(this.key);
                this.$.pages.entryAnimation = "slide-from-right-animation";
                this.$.pages.exitAnimation = "slide-left-animation";
                this.$.pages.selected = 1;
            },
            _onAdd: function () {
                this.key = "0";
                this.$.editor.load(this.key);
                this.$.pages.entryAnimation = "slide-from-right-animation";
                this.$.pages.exitAnimation = "slide-left-animation";
                this.$.pages.selected = 1;
            },
            _onClose: function () {
                this.$.pages.entryAnimation = "slide-from-left-animation";
                this.$.pages.exitAnimation = "slide-right-animation";
                this.$.pages.selected = 0;
            }
        });
    </script>
</dom-module>
